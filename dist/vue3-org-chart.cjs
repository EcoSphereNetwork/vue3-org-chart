"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const e=require("vue"),$=require("panzoom"),b={class:"vue3-org-chart-node"},S={key:0,class:"vue3-org-chart-node-element-top-line"},R={key:1,class:"vue3-org-chart-node-element-bottom-line"},T={key:0,class:"vue3-org-chart-node-container"},O={__name:"Node",props:{id:String},setup(o){const n=o,s=e.ref(null),r=e.computed(()=>i.__show||!1),l=e.inject("api"),i=l.find(n.id),u=l.findChildren(n.id);e.onMounted(()=>{i.parentId||(l.$root.value=s.value,l.zoomReset())});const m=()=>{u.length&&(i.__show=!r.value,l.goToHome(s.value))};return(d,v)=>{const f=e.resolveComponent("Node",!0);return e.openBlock(),e.createElementBlock("div",b,[e.renderSlot(d.$slots,"top-border"),e.createElementVNode("div",{class:"vue3-org-chart-node-element",ref_key:"element",ref:s},[e.unref(i).parentId?(e.openBlock(),e.createElementBlock("div",S)):e.createCommentVNode("",!0),e.createElementVNode("div",{tabindex:"0",onKeydown:v[0]||(v[0]=e.withKeys(e.withModifiers(h=>e.unref(l).goToHome(s.value),["self","prevent"]),["space"]))},[e.renderSlot(d.$slots,"node",{item:e.unref(i),children:e.unref(u),show:r.value,toggleChildren:m})],32),e.unref(u).length&&r.value?(e.openBlock(),e.createElementBlock("div",R)):e.createCommentVNode("",!0)],512),e.createVNode(e.Transition,{name:"nodeTransition"},{default:e.withCtx(()=>[e.unref(u).length&&r.value?(e.openBlock(),e.createElementBlock("div",T,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(u),(h,g)=>(e.openBlock(),e.createBlock(f,{key:h.id,id:h.id,ref_for:!0,ref:"nodeRefs"},{"top-border":e.withCtx(()=>[e.createElementVNode("div",{class:e.normalizeClass(["vue3-org-chart-node-element-horizontal-line",{left:r.value&&g!==0,right:r.value&&g!==e.unref(u).length-1}])},null,2)]),node:e.withCtx(({item:_,children:y,show:k,toggleChildren:w})=>[e.renderSlot(d.$slots,"node",{item:_,children:y,show:k,toggleChildren:w})]),_:2},1032,["id"]))),128))])):e.createCommentVNode("",!0)]),_:3})])}}};function A(){const o=e.ref(),n=e.ref(null),s=e.ref(null);function r(){o.value=$(n.value,{zoomDoubleClickSpeed:1.4,maxZoom:5,minZoom:.1,initialZoom:1,bounds:!1})}return e.onMounted(()=>{o.value||r()}),{scene:n,container:s,instance:o}}function j({initialData:o,json:n}){const s=e.ref(!0),r=e.reactive(o),l=async i=>await(await fetch(i)).json();return e.onMounted(async()=>{n&&Object.assign(r,await l(n)),s.value=!1}),{data:r,loading:s}}function M(o,n,s,r){const l=e.ref(null),i=e.reactive({x:0,y:40});function u(t){return n.find(c=>c.id===t)}function m(t){return n.filter(c=>c.parentId===t)}function d(){return n.find(t=>t.parentId===""||!t.parentId)}function v(){return d().id}function f(){const t=o.value.getTransform(),c=0,a=32;if(t.scale!==1){const p=1-t.scale,C=t.x/p,B=t.y/p;o.value.smoothZoomAbs(C,B,1)}else o.value.smoothMoveTo(c,a)}function h(){const t=o.value.getTransform(),c=s.value.getBoundingClientRect(),a=r.value.getBoundingClientRect(),p=a.x-c.x,C=a.y-c.y,B=p+a.width/2,x=C+a.height/2;return{x:B,y:x,scale:t.scale}}function g(t){const c=s.value.getBoundingClientRect(),a=t.getBoundingClientRect(),p=c.x+c.width/2+i.x,C=c.y+i.y,B=a.x+a.width/2,x=a.y,V=p-B,N=C-x;o.value.moveBy(V,N,!0)}function _(){const{x:t,y:c,scale:a}=h();o.value.smoothZoomAbs(t,c,a*3/2)}function y(){const{x:t,y:c,scale:a}=h();o.value.smoothZoomAbs(t,c,a*2/3)}function k(){n.forEach(t=>{t.__show=!1})}function w(){n.forEach(t=>{t.__show=!0})}return{zoomReset:f,zoomIn:_,zoomOut:y,expandAll:w,collapseAll:k,$root:l,root:d,rootId:v,find:u,findChildren:m,goToHome:g}}const P={class:"vue3-org-chart"},Z={key:1},X={key:0},Y={key:1},E={__name:"Vue3OrgChart",props:{data:{type:Array,default:()=>[]},json:{type:String,default:""}},emits:["onReady"],setup(o,{emit:n}){const s=o,{instance:r,scene:l,container:i}=A();e.provide("panzoom",{instance:r,scene:l,container:i});const{data:u,loading:m}=j({initialData:s.data,json:s.json});e.provide("content",{data:u,loading:m});const d=M(r,u,i,l);e.provide("api",d);const v=n;return e.watch(()=>m.value,f=>{f||v("onReady",{api:d})}),(f,h)=>(e.openBlock(),e.createElementBlock("div",P,[e.createElementVNode("div",{ref_key:"container",ref:i,class:"vue3-org-chart-container"},[e.createElementVNode("div",{ref_key:"scene",ref:l,class:"vue3-org-chart-scene"},[e.unref(u).length?(e.openBlock(),e.createBlock(O,{id:e.unref(d).rootId(),key:"root"},{node:e.withCtx(({item:g,children:_,show:y,toggleChildren:k})=>[e.renderSlot(f.$slots,"node",{item:g,children:_,show:y,toggleChildren:k})]),_:3},8,["id"])):(e.openBlock(),e.createElementBlock("div",Z,[e.unref(m)?(e.openBlock(),e.createElementBlock("span",X,[e.renderSlot(f.$slots,"loading",{},()=>[e.createTextVNode("Loading...")])])):(e.openBlock(),e.createElementBlock("span",Y,[e.renderSlot(f.$slots,"no-data",{},()=>[e.createTextVNode("No data")])]))]))],512)],512)]))}},z={install(o,n={}){o.component("Vue3OrgChart",E)}};exports.Vue3OrgChart=E;exports.Vue3OrgChartPlugin=z;
