"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const e=require("vue"),V=require("panzoom"),S={class:"vue3-org-chart-node"},z={key:0,class:"vue3-org-chart-node-element-top-line"},T={key:1,class:"vue3-org-chart-node-element-bottom-line"},O={key:0,class:"vue3-org-chart-node-container"},P=e.defineComponent({__name:"Node",props:{id:{type:String,required:!0}},setup(a){const c=a,l=e.ref(null),i=e.inject("api"),s=i.find(c.id),n=e.computed(()=>s.__open||!1),o=i.findChildren(c.id);e.onMounted(()=>{s.parentId||(i.$root.value=l.value,i.zoomReset(),s.__open=!0)});const p=()=>{o.length&&(s.__open=!n.value,i.goToHome(l.value))};return(d,y)=>{const h=e.resolveComponent("Node",!0);return e.openBlock(),e.createElementBlock("div",S,[e.renderSlot(d.$slots,"top-border"),e.createElementVNode("div",{class:"vue3-org-chart-node-element",ref_key:"element",ref:l},[e.unref(s).parentId?(e.openBlock(),e.createElementBlock("div",z)):e.createCommentVNode("",!0),e.createElementVNode("div",{tabindex:"0",onKeydown:y[0]||(y[0]=e.withKeys(e.withModifiers(_=>e.unref(i).goToHome(l.value),["self","prevent"]),["space"]))},[e.renderSlot(d.$slots,"node",{item:e.unref(s),children:e.unref(o),open:n.value,toggleChildren:p})],32),e.unref(o).length&&n.value?(e.openBlock(),e.createElementBlock("div",T)):e.createCommentVNode("",!0)],512),e.createVNode(e.Transition,{name:"nodeTransition"},{default:e.withCtx(()=>[e.unref(o).length&&n.value?(e.openBlock(),e.createElementBlock("div",O,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),(_,g)=>(e.openBlock(),e.createBlock(h,{key:_.id,id:_.id,ref_for:!0,ref:"nodeRefs"},{"top-border":e.withCtx(()=>[e.createElementVNode("div",{class:e.normalizeClass(["vue3-org-chart-node-element-horizontal-line",{left:n.value&&g!==0,right:n.value&&g!==e.unref(o).length-1}])},null,2)]),node:e.withCtx(v=>[e.renderSlot(d.$slots,"node",e.mergeProps({ref_for:!0},v))]),_:2},1032,["id"]))),128))])):e.createCommentVNode("",!0)]),_:3})])}}});function j(){let a=e.ref();const c=e.ref(null),l=e.ref(null);function i(){c.value&&(a.value=V(c.value,{zoomDoubleClickSpeed:1.4,maxZoom:5,minZoom:.1,initialZoom:1,bounds:!1}))}return e.onMounted(()=>{a.value||i()}),{instance:a,container:l,scene:c}}function A({initialData:a,json:c}){const l=e.ref(!0),i=e.reactive(a),s=async n=>await(await fetch(n)).json();return e.onMounted(async()=>{c&&Object.assign(i,await s(c)),l.value=!1}),{data:i,loading:l}}function H(a,c,l,i,s){const n=e.ref(null),o=e.reactive({x:0,y:40}),p=e.reactive({state:s,toggle:()=>{p.state=!p.state}});function d(t){const r=c.find(u=>u.id===t);if(!r)throw new Error(`Node with id ${t} not found`);return r}function y(t){return c.filter(r=>r.parentId===t)}function h(){const t=c.find(r=>r.parentId===""||!r.parentId);if(!t)throw new Error("Root node not found");return t}function _(){var t;return(t=h())==null?void 0:t.id}function g(){const t=a.value.getTransform(),r=0,u=32;if(t.scale!==1){const x=1-t.scale,k=t.x/x,B=t.y/x;a.value.smoothZoomAbs(k,B,1)}else a.value.smoothMoveTo(r,u)}function v(){var w,b;const t=a.value.getTransform(),r=(w=l.value)==null?void 0:w.getBoundingClientRect(),u=(b=i.value)==null?void 0:b.getBoundingClientRect();if(!r||!u)return{...o,scale:1};const x=u.x-r.x,k=u.y-r.y,B=x+u.width/2,N=k+u.height/2;return{x:B,y:N,scale:t.scale}}function C(t){var R;const r=(R=l.value)==null?void 0:R.getBoundingClientRect();if(!r||!t)return;const u=t.getBoundingClientRect(),x=r.x+r.width/2+o.x,k=r.y+o.y,B=u.x+u.width/2,N=u.y,w=x-B,b=k-N;a.value.moveBy(w,b,!0)}function M(){const{x:t,y:r,scale:u}=v();a.value.smoothZoomAbs(t,r,u*3/2)}function E(){const{x:t,y:r,scale:u}=v();a.value.smoothZoomAbs(t,r,u*2/3)}function f(){c.forEach(t=>{t.__open=!1})}function m(){c.forEach(t=>{t.__open=!0})}return{zoomReset:g,zoomIn:M,zoomOut:E,expandAll:m,collapseAll:f,$root:n,root:h,rootId:_,find:d,findChildren:y,goToHome:C,minimap:p}}const Z=e.defineComponent({__name:"MiniMap",props:{size:{type:Number,default:1/6}},setup(a){const{instance:c,scene:l,container:i}=e.inject("panzoom"),s=a,n=e.ref({width:0,height:0,top:0,left:0}),o=e.ref({width:0,height:0,top:0,left:0}),p=e.computed(()=>n.value.width*s.size),d=e.computed(()=>n.value.height*s.size),y=(f,m)=>{let t;return function(...r){clearTimeout(t),t=setTimeout(()=>f.apply(this,r),m)}},h=()=>{!i.value||!l.value||!(l.value.firstChild instanceof HTMLElement)||(n.value=i.value.getBoundingClientRect(),o.value=l.value.firstChild.getBoundingClientRect())},_=y(h,500);e.onMounted(()=>{h(),c.value.on("transform",h);const f=new ResizeObserver(_);i.value&&f.observe(i.value),l.value&&f.observe(l.value)});const g=e.computed(()=>({left:n.value.left-o.value.left+n.value.width,right:o.value.left-n.value.left+o.value.width,top:n.value.top-o.value.top+n.value.height,bottom:o.value.top-n.value.top+o.value.height})),v=f=>{const m=Math.max(g.value.left,g.value.right,n.value.width,o.value.width),t=Math.max(g.value.top,g.value.bottom,n.value.height,o.value.height);return f*Math.min(p.value/m,d.value/t)},C=(f,m,t,r)=>({width:`${f}px`,height:`${m}px`,left:`${Math.max(t,0)}px`,top:`${Math.max(r,0)}px`}),M=e.computed(()=>{const f=v(n.value.width),m=v(n.value.height),t=Math.max(v(n.value.left-o.value.left),0),r=Math.max(v(n.value.top-o.value.top),0);return C(f,m,t,r)}),E=e.computed(()=>{const f=v(o.value.width),m=v(o.value.height),t=Math.min(v(o.value.left-n.value.left),p.value-v(o.value.width)),r=Math.min(v(o.value.top-n.value.top),d.value-v(o.value.height));return C(f,m,t,r)});return(f,m)=>(e.openBlock(),e.createElementBlock("div",{style:e.normalizeStyle([{width:p.value+"px",height:d.value+"px"},{position:"absolute",padding:"0",bottom:"0",right:"0",border:"1px solid #e1e1e1","pointer-events":"none"}])},[e.createElementVNode("div",{style:e.normalizeStyle([{position:"absolute","background-color":"rgba(255,255,255,0.30)",border:"1px solid #ff8c8c","pointer-events":"none"},E.value])},null,4),e.createElementVNode("div",{style:e.normalizeStyle([{position:"absolute","background-color":"rgba(255,255,255,0.30)",border:"1px solid #8ee5f8","pointer-events":"none"},M.value])},null,4)],4))}}),D={class:"vue3-org-chart"},X={key:1},Y={key:0},I={key:1},$=e.defineComponent({__name:"Vue3OrgChart",props:{data:{default:()=>[]},json:{},minimap:{type:Boolean,default:!1}},emits:["onReady"],setup(a,{emit:c}){const l=a,{instance:i,scene:s,container:n}=j();e.provide("panzoom",{instance:i,scene:s,container:n});const{data:o,loading:p}=A({initialData:l.data,json:l.json});e.provide("content",{data:o,loading:p});const d=H(i,o,n,s,l.minimap);e.provide("api",d);const y=c;return e.watch(()=>p.value,h=>{h||y("onReady",{api:d})}),(h,_)=>(e.openBlock(),e.createElementBlock("div",D,[e.createElementVNode("div",{ref_key:"container",ref:n,class:"vue3-org-chart-container"},[e.createElementVNode("div",{ref_key:"scene",ref:s,class:"vue3-org-chart-scene"},[e.unref(o).length&&e.unref(d).rootId()?(e.openBlock(),e.createBlock(P,{id:e.unref(d).rootId(),key:"root"},{node:e.withCtx(g=>[e.renderSlot(h.$slots,"node",e.normalizeProps(e.guardReactiveProps(g)))]),_:3},8,["id"])):(e.openBlock(),e.createElementBlock("div",X,[e.unref(p)?(e.openBlock(),e.createElementBlock("span",Y,[e.renderSlot(h.$slots,"loading",{},()=>[e.createTextVNode("Loading...")])])):(e.openBlock(),e.createElementBlock("span",I,[e.renderSlot(h.$slots,"no-data",{},()=>[e.createTextVNode("No data")])]))]))],512)],512),!e.unref(p)&&e.unref(d).minimap.state?(e.openBlock(),e.createBlock(Z,{key:0})):e.createCommentVNode("",!0)]))}}),q={install(a,c={}){a.component("Vue3OrgChart",$)}};exports.Vue3OrgChart=$;exports.Vue3OrgChartPlugin=q;
