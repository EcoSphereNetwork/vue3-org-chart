"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const e=require("vue"),b=require("panzoom"),R={class:"vue3-org-chart-node"},S={key:0,class:"vue3-org-chart-node-element-top-line"},T={key:1,class:"vue3-org-chart-node-element-bottom-line"},O={key:0,class:"vue3-org-chart-node-container"},P=e.defineComponent({__name:"Node",props:{id:{type:String,required:!0}},setup(n){const r=n,i=e.ref(null),s=e.inject("api"),a=s.find(r.id),l=e.computed(()=>a.__open||!1),u=s.findChildren(r.id);e.onMounted(()=>{a.parentId||(s.$root.value=i.value,s.zoomReset(),a.__open=!0)});const m=()=>{u.length&&(a.__open=!l.value,s.goToHome(i.value))};return(d,h)=>{const f=e.resolveComponent("Node",!0);return e.openBlock(),e.createElementBlock("div",R,[e.renderSlot(d.$slots,"top-border"),e.createElementVNode("div",{class:"vue3-org-chart-node-element",ref_key:"element",ref:i},[e.unref(a).parentId?(e.openBlock(),e.createElementBlock("div",S)):e.createCommentVNode("",!0),e.createElementVNode("div",{tabindex:"0",onKeydown:h[0]||(h[0]=e.withKeys(e.withModifiers(p=>e.unref(s).goToHome(i.value),["self","prevent"]),["space"]))},[e.renderSlot(d.$slots,"node",{item:e.unref(a),children:e.unref(u),open:l.value,toggleChildren:m})],32),e.unref(u).length&&l.value?(e.openBlock(),e.createElementBlock("div",T)):e.createCommentVNode("",!0)],512),e.createVNode(e.Transition,{name:"nodeTransition"},{default:e.withCtx(()=>[e.unref(u).length&&l.value?(e.openBlock(),e.createElementBlock("div",O,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(u),(p,v)=>(e.openBlock(),e.createBlock(f,{key:p.id,id:p.id,ref_for:!0,ref:"nodeRefs"},{"top-border":e.withCtx(()=>[e.createElementVNode("div",{class:e.normalizeClass(["vue3-org-chart-node-element-horizontal-line",{left:l.value&&v!==0,right:l.value&&v!==e.unref(u).length-1}])},null,2)]),node:e.withCtx(_=>[e.renderSlot(d.$slots,"node",e.mergeProps({ref_for:!0},_))]),_:2},1032,["id"]))),128))])):e.createCommentVNode("",!0)]),_:3})])}}});function j(){const n=e.ref(),r=e.ref(null),i=e.ref(null);function s(){r.value&&(n.value=b(r.value,{zoomDoubleClickSpeed:1.4,maxZoom:5,minZoom:.1,initialZoom:1,bounds:!1}))}return e.onMounted(()=>{n.value||s()}),{scene:r,container:i,instance:n}}function A({initialData:n,json:r}){const i=e.ref(!0),s=e.reactive(n),a=async l=>await(await fetch(l)).json();return e.onMounted(async()=>{r&&Object.assign(s,await a(r)),i.value=!1}),{data:s,loading:i}}function M(n,r,i,s){const a=e.ref(null),l=e.reactive({x:0,y:40});function u(o){const t=r.find(c=>c.id===o);if(!t)throw new Error(`Node with id ${o} not found`);return t}function m(o){return r.filter(t=>t.parentId===o)}function d(){const o=r.find(t=>t.parentId===""||!t.parentId);if(!o)throw new Error("Root node not found");return o}function h(){var o;return(o=d())==null?void 0:o.id}function f(){const o=n.value.getTransform(),t=0,c=32;if(o.scale!==1){const g=1-o.scale,k=o.x/g,y=o.y/g;n.value.smoothZoomAbs(k,y,1)}else n.value.smoothMoveTo(t,c)}function p(){var C,B;const o=n.value.getTransform(),t=(C=i.value)==null?void 0:C.getBoundingClientRect(),c=(B=s.value)==null?void 0:B.getBoundingClientRect();if(!t||!c)return{...l,scale:1};const g=c.x-t.x,k=c.y-t.y,y=g+c.width/2,E=k+c.height/2;return{x:y,y:E,scale:o.scale}}function v(o){var N;const t=(N=i.value)==null?void 0:N.getBoundingClientRect();if(!t||!o)return;const c=o.getBoundingClientRect(),g=t.x+t.width/2+l.x,k=t.y+l.y,y=c.x+c.width/2,E=c.y,C=g-y,B=k-E;n.value.moveBy(C,B,!0)}function _(){const{x:o,y:t,scale:c}=p();n.value.smoothZoomAbs(o,t,c*3/2)}function x(){const{x:o,y:t,scale:c}=p();n.value.smoothZoomAbs(o,t,c*2/3)}function w(){r.forEach(o=>{o.__open=!1})}function $(){r.forEach(o=>{o.__open=!0})}return{zoomReset:f,zoomIn:_,zoomOut:x,expandAll:$,collapseAll:w,$root:a,root:d,rootId:h,find:u,findChildren:m,goToHome:v}}const Z={class:"vue3-org-chart"},X={key:1},Y={key:0},z={key:1},V=e.defineComponent({__name:"Vue3OrgChart",props:{data:{default:()=>[]},json:{}},emits:["onReady"],setup(n,{emit:r}){const i=n,{instance:s,scene:a,container:l}=j();e.provide("panzoom",{instance:s,scene:a,container:l});const{data:u,loading:m}=A({initialData:i.data,json:i.json});e.provide("content",{data:u,loading:m});const d=M(s,u,l,a);e.provide("api",d);const h=r;return e.watch(()=>m.value,f=>{f||h("onReady",{api:d})}),(f,p)=>(e.openBlock(),e.createElementBlock("div",Z,[e.createElementVNode("div",{ref_key:"container",ref:l,class:"vue3-org-chart-container"},[e.createElementVNode("div",{ref_key:"scene",ref:a,class:"vue3-org-chart-scene"},[e.unref(u).length&&e.unref(d).rootId()?(e.openBlock(),e.createBlock(P,{id:e.unref(d).rootId(),key:"root"},{node:e.withCtx(({item:v,children:_,open:x,toggleChildren:w})=>[e.renderSlot(f.$slots,"node",{item:v,children:_,open:x,toggleChildren:w})]),_:3},8,["id"])):(e.openBlock(),e.createElementBlock("div",X,[e.unref(m)?(e.openBlock(),e.createElementBlock("span",Y,[e.renderSlot(f.$slots,"loading",{},()=>[e.createTextVNode("Loading...")])])):(e.openBlock(),e.createElementBlock("span",z,[e.renderSlot(f.$slots,"no-data",{},()=>[e.createTextVNode("No data")])]))]))],512)],512)]))}}),D={install(n,r={}){n.component("Vue3OrgChart",V)}};exports.Vue3OrgChart=V;exports.Vue3OrgChartPlugin=D;
