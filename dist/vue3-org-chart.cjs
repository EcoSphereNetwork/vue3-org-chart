"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const e=require("vue"),V=require("panzoom"),N={class:"vue3-org-chart-node"},E={key:0,class:"vue3-org-chart-node-element-top-line"},$={key:1,class:"vue3-org-chart-node-element-bottom-line"},S={key:0,class:"vue3-org-chart-node-container"},b={__name:"Node",props:{id:String},setup(o){const l=o,s=e.ref(null),{data:d}=e.inject("content"),c=e.ref(!1),a=e.inject("api"),f=a.find(l.id),i=e.reactive(d.value.filter(m=>m.parentId===l.id));e.onMounted(()=>{f.parentId||(a.$root.value=s.value,a.zoomReset())});const h=()=>{i.length&&(c.value=!c.value,a.goToHome(s.value))};return(m,u)=>{const _=e.resolveComponent("Node",!0);return e.openBlock(),e.createElementBlock("div",N,[e.renderSlot(m.$slots,"top-border"),e.createElementVNode("div",{class:"vue3-org-chart-node-element",ref_key:"element",ref:s},[e.unref(f).parentId?(e.openBlock(),e.createElementBlock("div",E)):e.createCommentVNode("",!0),e.createElementVNode("div",{tabindex:"0",onKeydown:u[0]||(u[0]=e.withKeys(e.withModifiers(g=>e.unref(a).goToHome(s.value),["self","prevent"]),["space"]))},[e.renderSlot(m.$slots,"node",{item:e.unref(f),nodes:i,show:c.value,toggleChildren:h})],32),i.length&&c.value?(e.openBlock(),e.createElementBlock("div",$)):e.createCommentVNode("",!0)],512),e.createVNode(e.Transition,{name:"nodeTransition"},{default:e.withCtx(()=>[i.length&&c.value?(e.openBlock(),e.createElementBlock("div",S,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i,(g,p)=>(e.openBlock(),e.createBlock(_,{key:g.id,id:g.id,ref_for:!0,ref:"nodeRefs"},{"top-border":e.withCtx(()=>[e.createElementVNode("div",{class:e.normalizeClass(["vue3-org-chart-node-element-horizontal-line",{left:c.value&&p!==0,right:c.value&&p!==i.length-1}])},null,2)]),node:e.withCtx(({item:t,nodes:n,show:r,toggleChildren:v})=>[e.renderSlot(m.$slots,"node",{item:t,nodes:n,show:r,toggleChildren:v})]),_:2},1032,["id"]))),128))])):e.createCommentVNode("",!0)]),_:3})])}}};function R(){const o=e.ref(),l=e.ref(null),s=e.ref(null);function d(){o.value=V(l.value,{zoomDoubleClickSpeed:1.4,maxZoom:5,minZoom:.1,initialZoom:1,bounds:!1})}return e.onMounted(()=>{o.value||d()}),{scene:l,container:s,instance:o}}function T({initialData:o,json:l}){const s=e.ref(!0),d=e.ref(o),c=async a=>await(await fetch(a)).json();return e.onMounted(async()=>{l&&(d.value=await c(l)),s.value=!1}),{data:d,loading:s}}function O(o,l,s,d){const c=e.ref(null),a=e.reactive({x:0,y:40});function f(t){return l.value.find(n=>n.id===t)}function i(){return l.value.find(t=>t.parentId===""||!t.parentId)}function h(){return i().id}function m(){const t=o.value.getTransform(),n=0,r=32;if(t.scale!==1){const v=1-t.scale,y=t.x/v,k=t.y/v;o.value.smoothZoomAbs(y,k,1)}else o.value.smoothMoveTo(n,r)}function u(){const t=o.value.getTransform(),n=s.value.getBoundingClientRect(),r=d.value.getBoundingClientRect(),v=r.x-n.x,y=r.y-n.y,k=v+r.width/2,C=y+r.height/2;return{x:k,y:C,scale:t.scale}}function _(t){const n=s.value.getBoundingClientRect(),r=t.getBoundingClientRect(),v=n.x+n.width/2+a.x,y=n.y+a.y,k=r.x+r.width/2,C=r.y,x=v-k,w=y-C;o.value.moveBy(x,w,!0)}function g(){const{x:t,y:n,scale:r}=u();o.value.smoothZoomAbs(t,n,r*3/2)}function p(){const{x:t,y:n,scale:r}=u();o.value.smoothZoomAbs(t,n,r*2/3)}return{zoomReset:m,zoomIn:g,zoomOut:p,$root:c,root:i,rootId:h,find:f,goToHome:_}}const j={class:"vue3-org-chart"},M={key:1},P={key:0},Z={key:1},B={__name:"Vue3OrgChart",props:{data:{type:Array,default:()=>[]},json:{type:String,default:""}},emits:["onReady"],setup(o,{emit:l}){const s=o,{instance:d,scene:c,container:a}=R();e.provide("panzoom",{instance:d,scene:c,container:a});const{data:f,loading:i}=T({initialData:s.data,json:s.json});e.provide("content",{data:f,loading:i});const h=O(d,f,a,c);e.provide("api",h);const m=l;return e.watch(()=>i.value,u=>{u||m("onReady",{api:h})}),(u,_)=>(e.openBlock(),e.createElementBlock("div",j,[e.createElementVNode("div",{ref_key:"container",ref:a,class:"vue3-org-chart-container"},[e.createElementVNode("div",{ref_key:"scene",ref:c,class:"vue3-org-chart-scene"},[e.unref(f).length?(e.openBlock(),e.createBlock(b,{id:e.unref(h).rootId(),key:"root"},{node:e.withCtx(({item:g,nodes:p,show:t,toggleChildren:n})=>[e.renderSlot(u.$slots,"node",{item:g,nodes:p,show:t,toggleChildren:n})]),_:3},8,["id"])):(e.openBlock(),e.createElementBlock("div",M,[e.unref(i)?(e.openBlock(),e.createElementBlock("span",P,[e.renderSlot(u.$slots,"loading",{},()=>[e.createTextVNode("Loading...")])])):(e.openBlock(),e.createElementBlock("span",Z,[e.renderSlot(u.$slots,"no-data",{},()=>[e.createTextVNode("No data")])]))]))],512)],512)]))}},A={install(o,l={}){o.component("Vue3OrgChart",B)}};exports.Vue3OrgChart=B;exports.Vue3OrgChartPlugin=A;
