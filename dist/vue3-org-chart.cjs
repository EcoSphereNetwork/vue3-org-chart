"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const e=require("vue"),C=require("panzoom"),w={class:"vue3-org-chart-node"},N={key:0,class:"vue3-org-chart-node-element-top-line"},V=["onKeydown"],E={key:1,class:"vue3-org-chart-node-element-bottom-line"},x={key:0,class:"vue3-org-chart-node-container"},S={__name:"Node",props:{id:String},setup(t){const r=t,c=e.ref(null),{instance:a,container:d}=e.inject("panzoom"),{data:n}=e.inject("content"),o=e.ref(!1),u=n.value.find(i=>i.id===r.id),s=e.reactive(n.value.filter(i=>i.parentId===r.id)),g=()=>{s.length&&(o.value=!o.value,l(c.value))},l=i=>{const f=d.value.getBoundingClientRect(),m=i.getBoundingClientRect(),h=f.x+f.width/2,v=f.y+f.height/4,p=m.x+m.width/2,k=m.y+m.height/2,_=h-p,y=v-k;a.value.moveBy(_,y,!0)};return(i,f)=>{const m=e.resolveComponent("Node",!0);return e.openBlock(),e.createElementBlock("div",w,[e.renderSlot(i.$slots,"top-border"),e.createElementVNode("div",{class:"vue3-org-chart-node-element",ref_key:"element",ref:c},[e.unref(u).parentId?(e.openBlock(),e.createElementBlock("div",N)):e.createCommentVNode("",!0),e.createElementVNode("div",{tabindex:"0",onKeydown:e.withKeys(e.withModifiers(l,["self","prevent"]),["space"])},[e.renderSlot(i.$slots,"node",{item:e.unref(u),nodes:s,show:o.value,toggleChildren:g})],40,V),s.length&&o.value?(e.openBlock(),e.createElementBlock("div",E)):e.createCommentVNode("",!0)],512),e.createVNode(e.Transition,{name:"nodeTransition"},{default:e.withCtx(()=>[s.length&&o.value?(e.openBlock(),e.createElementBlock("div",x,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s,(h,v)=>(e.openBlock(),e.createBlock(m,{key:h.id,id:h.id,ref_for:!0,ref:"nodeRefs"},{"top-border":e.withCtx(()=>[e.createElementVNode("div",{class:e.normalizeClass(["vue3-org-chart-node-element-horizontal-line",{left:o.value&&v!==0,right:o.value&&v!==s.length-1}])},null,2)]),node:e.withCtx(({item:p,nodes:k,show:_,toggleChildren:y})=>[e.renderSlot(i.$slots,"node",{item:p,nodes:k,show:_,toggleChildren:y})]),_:2},1032,["id"]))),128))])):e.createCommentVNode("",!0)]),_:3})])}}};function $(){const t=e.ref(),r=e.ref(null),c=e.ref(null);function a(){t.value=C(r.value,{zoomDoubleClickSpeed:1.4,maxZoom:5,minZoom:.1,initialX:0,initialZoom:1,bounds:!1})}return e.onMounted(()=>{t.value||a()}),{scene:r,container:c,instance:t}}function b({initialData:t,json:r}){const c=e.ref(!0),a=e.ref(t),d=async n=>await(await fetch(n)).json();return e.onMounted(async()=>{r&&(a.value=await d(r)),c.value=!1}),{data:a,loading:c}}function R(t,r){function c(){return r.value.find(n=>n.parentId===""||!n.parentId)}function a(){return c().id}function d(){const n=t.value.getTransform(),o=0,u=0;if(n.scale!==1){const s=1-n.scale,g=n.x/s,l=n.y/s;t.value.smoothZoomAbs(g,l,1)}else t.value.smoothMoveTo(o,u)}return{reset:d,getRoot:c,getRootId:a}}const T={class:"vue3-org-chart"},j={key:1},O={key:0},z={key:1},B={__name:"Vue3OrgChart",props:{data:{type:Array,default:()=>[]},json:{type:String,default:""}},emits:["onReady"],setup(t,{emit:r}){const c=t,{instance:a,scene:d,container:n}=$();e.provide("panzoom",{instance:a,scene:d,container:n});const{data:o,loading:u}=b({initialData:c.data,json:c.json});e.provide("content",{data:o,loading:u});const s=R(a,o),g=r;return e.watch(()=>u.value,l=>{l||g("onReady",{api:s})}),(l,i)=>(e.openBlock(),e.createElementBlock("div",T,[e.createElementVNode("div",{ref_key:"container",ref:n,class:"vue3-org-chart-container"},[e.createElementVNode("div",{ref_key:"scene",ref:d,class:"vue3-org-chart-scene"},[e.unref(o).length?(e.openBlock(),e.createBlock(S,{id:e.unref(s).getRootId(),key:"root"},{node:e.withCtx(({item:f,nodes:m,show:h,toggleChildren:v})=>[e.renderSlot(l.$slots,"node",{item:f,nodes:m,show:h,toggleChildren:v})]),_:3},8,["id"])):(e.openBlock(),e.createElementBlock("div",j,[e.unref(u)?(e.openBlock(),e.createElementBlock("span",O,[e.renderSlot(l.$slots,"loading",{},()=>[e.createTextVNode("Loading...")])])):(e.openBlock(),e.createElementBlock("span",z,[e.renderSlot(l.$slots,"no-data",{},()=>[e.createTextVNode("No data")])]))]))],512)],512)]))}},I={install(t,r={}){t.component("Vue3OrgChart",B)}};exports.Vue3OrgChart=B;exports.Vue3OrgChartPlugin=I;
