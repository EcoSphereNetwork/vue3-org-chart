"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const e=require("vue"),N=require("panzoom"),V={class:"vue3-org-chart-node"},$={key:0,class:"vue3-org-chart-node-element-top-line"},S={key:1,class:"vue3-org-chart-node-element-bottom-line"},T={key:0,class:"vue3-org-chart-node-container"},z=e.defineComponent({__name:"Node",props:{id:{type:String,required:!0}},setup(c){const r=c,i=e.ref(null),a=e.inject("api"),n=a.find(r.id),t=e.computed(()=>n.__open||!1),h=a.findChildren(r.id);e.onMounted(()=>{n.parentId||(a.$root.value=i.value,a.zoomReset())});const g=()=>{h.length&&(n.__open=!t.value,a.goToHome(i.value))};return(v,p)=>{const f=e.resolveComponent("Node",!0);return e.openBlock(),e.createElementBlock("div",V,[e.renderSlot(v.$slots,"top-border"),e.createElementVNode("div",{class:"vue3-org-chart-node-element",ref_key:"element",ref:i},[e.unref(n).parentId?(e.openBlock(),e.createElementBlock("div",$)):e.createCommentVNode("",!0),e.createElementVNode("div",{tabindex:"0",onKeydown:p[0]||(p[0]=e.withKeys(e.withModifiers(m=>e.unref(a).goToHome(i.value),["self","prevent"]),["space"]))},[e.renderSlot(v.$slots,"node",{item:e.unref(n),children:e.unref(h),open:t.value,toggleChildren:g})],32),e.unref(h).length&&t.value?(e.openBlock(),e.createElementBlock("div",S)):e.createCommentVNode("",!0)],512),e.createVNode(e.Transition,{name:"nodeTransition"},{default:e.withCtx(()=>[e.unref(h).length&&t.value?(e.openBlock(),e.createElementBlock("div",T,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(h),(m,u)=>(e.openBlock(),e.createBlock(f,{key:m.id,id:m.id,ref_for:!0,ref:"nodeRefs"},{"top-border":e.withCtx(()=>[e.createElementVNode("div",{class:e.normalizeClass(["vue3-org-chart-node-element-horizontal-line",{left:t.value&&u!==0,right:t.value&&u!==e.unref(h).length-1}])},null,2)]),node:e.withCtx(_=>[e.renderSlot(v.$slots,"node",e.mergeProps({ref_for:!0},_))]),_:2},1032,["id"]))),128))])):e.createCommentVNode("",!0)]),_:3})])}}});function O(){let c=e.ref();const r=e.ref(null),i=e.ref(null);function a(){r.value&&(c.value=N(r.value,{zoomDoubleClickSpeed:1.4,maxZoom:5,minZoom:.1,initialZoom:1,bounds:!1}))}return e.onMounted(()=>{c.value||a()}),{instance:c,container:i,scene:r}}function P({initialData:c,json:r}){const i=e.ref(!0),a=e.reactive(c),n=async t=>await(await fetch(t)).json();return e.onMounted(async()=>{r&&Object.assign(a,await n(r)),i.value=!1}),{data:a,loading:i}}function j(c,r,i,a){const n=e.ref(null),t=e.reactive({x:0,y:40});function h(o){const l=r.find(s=>s.id===o);if(!l)throw new Error(`Node with id ${o} not found`);return l}function g(o){return r.filter(l=>l.parentId===o)}function v(){const o=r.find(l=>l.parentId===""||!l.parentId);if(!o)throw new Error("Root node not found");return o}function p(){var o;return(o=v())==null?void 0:o.id}function f(){const o=c.value.getTransform(),l=0,s=32;if(o.scale!==1){const x=1-o.scale,k=o.x/x,C=o.y/x;c.value.smoothZoomAbs(k,C,1)}else c.value.smoothMoveTo(l,s)}function m(){var B,b;const o=c.value.getTransform(),l=(B=i.value)==null?void 0:B.getBoundingClientRect(),s=(b=a.value)==null?void 0:b.getBoundingClientRect();if(!l||!s)return{...t,scale:1};const x=s.x-l.x,k=s.y-l.y,C=x+s.width/2,M=k+s.height/2;return{x:C,y:M,scale:o.scale}}function u(o){var E;const l=(E=i.value)==null?void 0:E.getBoundingClientRect();if(!l||!o)return;const s=o.getBoundingClientRect(),x=l.x+l.width/2+t.x,k=l.y+t.y,C=s.x+s.width/2,M=s.y,B=x-C,b=k-M;c.value.moveBy(B,b,!0)}function _(){const{x:o,y:l,scale:s}=m();c.value.smoothZoomAbs(o,l,s*3/2)}function w(){const{x:o,y:l,scale:s}=m();c.value.smoothZoomAbs(o,l,s*2/3)}function y(){r.forEach(o=>{o.__open=!1})}function d(){r.forEach(o=>{o.__open=!0})}return{zoomReset:f,zoomIn:_,zoomOut:w,expandAll:d,collapseAll:y,$root:n,root:v,rootId:p,find:h,findChildren:g,goToHome:u}}const A={style:{position:"relative"}},H=e.defineComponent({__name:"MiniMap",setup(c){const{instance:r,scene:i,container:a}=e.inject("panzoom"),n=e.ref({width:0,height:0,top:0,left:0}),t=e.ref({width:0,height:0,top:0,left:0});function h(d,o){let l;return function(...s){const x=this;clearTimeout(l),l=setTimeout(()=>{d.apply(x,s)},o)}}const g=()=>{if(!a.value||!i.value||!(i.value.firstChild instanceof HTMLElement))return;const d=a.value.getBoundingClientRect(),o=i.value.firstChild.getBoundingClientRect();n.value={width:d.width,height:d.height,top:d.top,left:d.left},t.value={width:o.width,height:o.height,top:o.top,left:o.left}},v=h(g,500);e.watch(()=>r.value,()=>{r.value&&r.value.on("transform",()=>g())}),e.onMounted(()=>{v(),a.value&&new ResizeObserver(v).observe(a.value),i.value&&new ResizeObserver(v).observe(i.value)});const p=e.ref(200),f=e.ref(200),m=e.computed(()=>({left:n.value.left-t.value.left+n.value.width,right:t.value.left-n.value.left+t.value.width,top:t.value.top-n.value.top,bottom:n.value.height-t.value.top+t.value.height})),u=d=>{const o=Math.max(m.value.left,m.value.right,n.value.width,t.value.width),l=Math.max(m.value.top,m.value.bottom,n.value.height,t.value.height);return d*Math.min(p.value/o,f.value/l)},_=()=>{let d=Math.min(p.value/t.value.width,f.value/t.value.height);return t.value.width/n.value.width<=1&&(d=d*t.value.width/n.value.width),{x:(t.value.left-n.value.left)*d,y:(t.value.top-n.value.top)*d}},w=e.computed(()=>({width:u(n.value.width),height:u(n.value.height),left:Math.max(u(n.value.left)-u(t.value.left),0),top:Math.max(u(n.value.top)-u(t.value.top),0)})),y=e.computed(()=>({width:u(t.value.width),height:u(t.value.height),left:Math.max(Math.min(_().x,p.value-u(t.value.width)),0),top:Math.max(Math.min(_().y,p.value-u(t.value.height)),0)}));return(d,o)=>(e.openBlock(),e.createElementBlock("div",{style:e.normalizeStyle([{width:p.value+"px",height:f.value+"px"},{position:"absolute",padding:"5px",bottom:"0",right:"0",border:"1px solid #e1e1e1","pointer-events":"none"}])},[e.createElementVNode("div",A,[e.createElementVNode("div",{style:e.normalizeStyle([{position:"absolute","background-color":"rgba(255,255,255,0.40)",border:"1px solid #495db9","pointer-events":"none"},{height:w.value.height+"px",width:w.value.width+"px",top:w.value.top+"px",left:w.value.left+"px"}])},null,4),e.createElementVNode("div",{style:e.normalizeStyle([{position:"absolute","background-color":"rgba(255,255,255,0.75)",border:"1px solid #d74848","pointer-events":"none"},{height:y.value.height+"px",width:y.value.width+"px",top:y.value.top+"px",left:y.value.left+"px"}])},null,4)])],4))}}),Z={class:"vue3-org-chart"},I={key:1},X={key:0},Y={key:1},R=e.defineComponent({__name:"Vue3OrgChart",props:{data:{default:()=>[]},json:{}},emits:["onReady"],setup(c,{emit:r}){const i=c,{instance:a,scene:n,container:t}=O();e.provide("panzoom",{instance:a,scene:n,container:t});const{data:h,loading:g}=P({initialData:i.data,json:i.json});e.provide("content",{data:h,loading:g});const v=j(a,h,t,n);e.provide("api",v);const p=r;return e.watch(()=>g.value,f=>{f||p("onReady",{api:v})}),(f,m)=>(e.openBlock(),e.createElementBlock("div",Z,[e.createElementVNode("div",{ref_key:"container",ref:t,class:"vue3-org-chart-container"},[e.createElementVNode("div",{ref_key:"scene",ref:n,class:"vue3-org-chart-scene"},[e.unref(h).length&&e.unref(v).rootId()?(e.openBlock(),e.createBlock(z,{id:e.unref(v).rootId(),key:"root"},{node:e.withCtx(u=>[e.renderSlot(f.$slots,"node",e.normalizeProps(e.guardReactiveProps(u)))]),_:3},8,["id"])):(e.openBlock(),e.createElementBlock("div",I,[e.unref(g)?(e.openBlock(),e.createElementBlock("span",X,[e.renderSlot(f.$slots,"loading",{},()=>[e.createTextVNode("Loading...")])])):(e.openBlock(),e.createElementBlock("span",Y,[e.renderSlot(f.$slots,"no-data",{},()=>[e.createTextVNode("No data")])]))]))],512)],512),e.createVNode(H)]))}}),D={install(c,r={}){c.component("Vue3OrgChart",R)}};exports.Vue3OrgChart=R;exports.Vue3OrgChartPlugin=D;
