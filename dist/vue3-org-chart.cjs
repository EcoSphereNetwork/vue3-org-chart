"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const e=require("vue"),w=require("panzoom"),x={class:"vue3-org-chart-node"},V={key:0,class:"vue3-org-chart-node-element-top-line"},N={key:1,class:"vue3-org-chart-node-element-bottom-line"},E={key:0,class:"vue3-org-chart-node-container"},T={__name:"Node",props:{id:String},setup(o){const s=o,n=e.ref(null),{data:i}=e.inject("content"),l=e.ref(!1),c=e.inject("api"),d=c.find(s.id),a=e.reactive(i.value.filter(f=>f.parentId===s.id));e.onMounted(()=>{d.parentId||(c.$root.value=n.value,c.zoomReset())});const g=()=>{a.length&&(l.value=!l.value,c.goToHome(n.value))};return(f,u)=>{const k=e.resolveComponent("Node",!0);return e.openBlock(),e.createElementBlock("div",x,[e.renderSlot(f.$slots,"top-border"),e.createElementVNode("div",{class:"vue3-org-chart-node-element",ref_key:"element",ref:n},[e.unref(d).parentId?(e.openBlock(),e.createElementBlock("div",V)):e.createCommentVNode("",!0),e.createElementVNode("div",{tabindex:"0",onKeydown:u[0]||(u[0]=e.withKeys(e.withModifiers(t=>e.unref(c).goToHome(n.value),["self","prevent"]),["space"]))},[e.renderSlot(f.$slots,"node",{item:e.unref(d),nodes:a,show:l.value,toggleChildren:g})],32),a.length&&l.value?(e.openBlock(),e.createElementBlock("div",N)):e.createCommentVNode("",!0)],512),e.createVNode(e.Transition,{name:"nodeTransition"},{default:e.withCtx(()=>[a.length&&l.value?(e.openBlock(),e.createElementBlock("div",E,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a,(t,r)=>(e.openBlock(),e.createBlock(k,{key:t.id,id:t.id,ref_for:!0,ref:"nodeRefs"},{"top-border":e.withCtx(()=>[e.createElementVNode("div",{class:e.normalizeClass(["vue3-org-chart-node-element-horizontal-line",{left:l.value&&r!==0,right:l.value&&r!==a.length-1}])},null,2)]),node:e.withCtx(({item:m,nodes:v,show:h,toggleChildren:p})=>[e.renderSlot(f.$slots,"node",{item:m,nodes:v,show:h,toggleChildren:p})]),_:2},1032,["id"]))),128))])):e.createCommentVNode("",!0)]),_:3})])}}};function $(){const o=e.ref(),s=e.ref(null),n=e.ref(null);function i(){o.value=w(s.value,{zoomDoubleClickSpeed:1.4,maxZoom:5,minZoom:.1,initialZoom:1,bounds:!1})}return e.onMounted(()=>{o.value||i()}),{scene:s,container:n,instance:o}}function S({initialData:o,json:s}){const n=e.ref(!0),i=e.ref(o),l=async c=>await(await fetch(c)).json();return e.onMounted(async()=>{s&&(i.value=await l(s)),n.value=!1}),{data:i,loading:n}}function R(o,s,n){const i=e.ref(null),l=e.reactive({x:0,y:40});function c(t){return s.value.find(r=>r.id===t)}function d(){return s.value.find(t=>t.parentId===""||!t.parentId)}function a(){return d().id}function g(){const t=o.value.getTransform(),r=0,m=32;if(t.scale!==1){const v=1-t.scale,h=t.x/v,p=t.y/v;o.value.smoothZoomAbs(h,p,1)}else o.value.smoothMoveTo(r,m)}function f(t){const r=n.value.getBoundingClientRect(),m=t.getBoundingClientRect(),v=r.x+r.width/2+l.x,h=r.y+l.y,p=m.x+m.width/2,_=m.y,B=v-p,C=h-_;o.value.moveBy(B,C,!0)}function u(){const t=o.value.getTransform(),r=n.value.getBoundingClientRect();o.value.zoomTo(r.width/2,t.y,2/3)}function k(){const t=o.value.getTransform(),r=n.value.getBoundingClientRect();o.value.zoomTo(r.width/2,t.y,3/2)}return{zoomReset:g,zoomIn:u,zoomOut:k,$root:i,root:d,rootId:a,find:c,goToHome:f}}const b={class:"vue3-org-chart"},O={key:1},j={key:0},M={key:1},y={__name:"Vue3OrgChart",props:{data:{type:Array,default:()=>[]},json:{type:String,default:""}},emits:["onReady"],setup(o,{emit:s}){const n=o,{instance:i,scene:l,container:c}=$();e.provide("panzoom",{instance:i,scene:l,container:c});const{data:d,loading:a}=S({initialData:n.data,json:n.json});e.provide("content",{data:d,loading:a});const g=R(i,d,c);e.provide("api",g);const f=s;return e.watch(()=>a.value,u=>{u||f("onReady",{api:g})}),(u,k)=>(e.openBlock(),e.createElementBlock("div",b,[e.createElementVNode("div",{ref_key:"container",ref:c,class:"vue3-org-chart-container"},[e.createElementVNode("div",{ref_key:"scene",ref:l,class:"vue3-org-chart-scene"},[e.unref(d).length?(e.openBlock(),e.createBlock(T,{id:e.unref(g).rootId(),key:"root"},{node:e.withCtx(({item:t,nodes:r,show:m,toggleChildren:v})=>[e.renderSlot(u.$slots,"node",{item:t,nodes:r,show:m,toggleChildren:v})]),_:3},8,["id"])):(e.openBlock(),e.createElementBlock("div",O,[e.unref(a)?(e.openBlock(),e.createElementBlock("span",j,[e.renderSlot(u.$slots,"loading",{},()=>[e.createTextVNode("Loading...")])])):(e.openBlock(),e.createElementBlock("span",M,[e.renderSlot(u.$slots,"no-data",{},()=>[e.createTextVNode("No data")])]))]))],512)],512)]))}},z={install(o,s={}){o.component("Vue3OrgChart",y)}};exports.Vue3OrgChart=y;exports.Vue3OrgChartPlugin=z;
