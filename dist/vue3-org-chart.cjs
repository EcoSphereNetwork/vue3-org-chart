"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const e=require("vue"),b=require("panzoom"),R={class:"vue3-org-chart-node"},S={key:0,class:"vue3-org-chart-node-element-top-line"},T={key:1,class:"vue3-org-chart-node-element-bottom-line"},O={key:0,class:"vue3-org-chart-node-container"},j=e.defineComponent({__name:"Node",props:{id:{type:String,required:!0}},setup(t){const r=t,l=e.ref(null),s=e.inject("api"),a=s.find(r.id),i=e.computed(()=>a.__hidden||!0),d=s.findChildren(r.id);e.onMounted(()=>{a.parentId||(s.$root.value=l.value,s.zoomReset(),a.__hidden=!1)});const h=()=>{d.length&&(a.__hidden=!show.value,s.goToHome(l.value))};return(u,v)=>{const f=e.resolveComponent("Node",!0);return e.openBlock(),e.createElementBlock("div",R,[e.renderSlot(u.$slots,"top-border"),e.createElementVNode("div",{class:"vue3-org-chart-node-element",ref_key:"element",ref:l},[e.unref(a).parentId?(e.openBlock(),e.createElementBlock("div",S)):e.createCommentVNode("",!0),e.createElementVNode("div",{tabindex:"0",onKeydown:v[0]||(v[0]=e.withKeys(e.withModifiers(m=>e.unref(s).goToHome(l.value),["self","prevent"]),["space"]))},[e.renderSlot(u.$slots,"node",{node:e.unref(a),children:e.unref(d),hidden:i.value,toggleChildren:h})],32),e.unref(d).length&&!i.value?(e.openBlock(),e.createElementBlock("div",T)):e.createCommentVNode("",!0)],512),e.createVNode(e.Transition,{name:"nodeTransition"},{default:e.withCtx(()=>[e.unref(d).length&&!i.value?(e.openBlock(),e.createElementBlock("div",O,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(d),(m,p)=>(e.openBlock(),e.createBlock(f,{key:m.id,id:m.id,ref_for:!0,ref:"nodeRefs"},{"top-border":e.withCtx(()=>[e.createElementVNode("div",{class:e.normalizeClass(["vue3-org-chart-node-element-horizontal-line",{left:!i.value&&p!==0,right:!i.value&&p!==e.unref(d).length-1}])},null,2)]),node:e.withCtx(y=>[e.renderSlot(u.$slots,"node",{node:m,children:e.unref(d),hidden:i.value,toggleChildren:h})]),_:2},1032,["id"]))),128))])):e.createCommentVNode("",!0)]),_:3})])}}});function A(){const t=e.ref(),r=e.ref(null),l=e.ref(null);function s(){r.value&&(t.value=b(r.value,{zoomDoubleClickSpeed:1.4,maxZoom:5,minZoom:.1,initialZoom:1,bounds:!1}))}return e.onMounted(()=>{t.value||s()}),{scene:r,container:l,instance:t}}function M({initialData:t,json:r}){const l=e.ref(!0),s=e.reactive(t),a=async i=>await(await fetch(i)).json();return e.onMounted(async()=>{r&&Object.assign(s,await a(r)),l.value=!1}),{data:s,loading:l}}function P(t,r,l,s){const a=e.ref(null),i=e.reactive({x:0,y:40});function d(n){const o=r.find(c=>c.id===n);if(!o)throw new Error(`Node with id ${n} not found`);return o}function h(n){return r.filter(o=>o.parentId===n)}function u(){const n=r.find(o=>o.parentId===""||!o.parentId);if(!n)throw new Error("Root node not found");return n}function v(){var n;return(n=u())==null?void 0:n.id}function f(){const n=t.value.getTransform(),o=0,c=32;if(n.scale!==1){const g=1-n.scale,_=n.x/g,k=n.y/g;t.value.smoothZoomAbs(_,k,1)}else t.value.smoothMoveTo(o,c)}function m(){var C,B;const n=t.value.getTransform(),o=(C=l.value)==null?void 0:C.getBoundingClientRect(),c=(B=s.value)==null?void 0:B.getBoundingClientRect();if(!o||!c)return{...i,scale:1};const g=c.x-o.x,_=c.y-o.y,k=g+c.width/2,E=_+c.height/2;return{x:k,y:E,scale:n.scale}}function p(n){var N;const o=(N=l.value)==null?void 0:N.getBoundingClientRect();if(!o||!n)return;const c=n.getBoundingClientRect(),g=o.x+o.width/2+i.x,_=o.y+i.y,k=c.x+c.width/2,E=c.y,C=g-k,B=_-E;t.value.moveBy(C,B,!0)}function y(){const{x:n,y:o,scale:c}=m();t.value.smoothZoomAbs(n,o,c*3/2)}function x(){const{x:n,y:o,scale:c}=m();t.value.smoothZoomAbs(n,o,c*2/3)}function w(){r.forEach(n=>{n.__hidden=!1})}function $(){r.forEach(n=>{n.__hidden=!0})}return{zoomReset:f,zoomIn:y,zoomOut:x,expandAll:$,collapseAll:w,$root:a,root:u,rootId:v,find:d,findChildren:h,goToHome:p}}const Z={class:"vue3-org-chart"},D={key:1},X={key:0},Y={key:1},V=e.defineComponent({__name:"Vue3OrgChart",props:{data:{default:()=>[]},json:{}},emits:["onReady"],setup(t,{emit:r}){const l=t,{instance:s,scene:a,container:i}=A();e.provide("panzoom",{instance:s,scene:a,container:i});const{data:d,loading:h}=M({initialData:l.data,json:l.json});e.provide("content",{data:d,loading:h});const u=P(s,d,i,a);e.provide("api",u);const v=r;return e.watch(()=>h.value,f=>{f||v("onReady",{api:u})}),(f,m)=>(e.openBlock(),e.createElementBlock("div",Z,[e.createElementVNode("div",{ref_key:"container",ref:i,class:"vue3-org-chart-container"},[e.createElementVNode("div",{ref_key:"scene",ref:a,class:"vue3-org-chart-scene"},[e.unref(d).length&&e.unref(u).rootId()?(e.openBlock(),e.createBlock(j,{id:e.unref(u).rootId(),key:"root"},{node:e.withCtx(({node:p,children:y,hidden:x,toggleChildren:w})=>[e.renderSlot(f.$slots,"node",{node:p,children:y,hidden:x,toggleChildren:w})]),_:3},8,["id"])):(e.openBlock(),e.createElementBlock("div",D,[e.unref(h)?(e.openBlock(),e.createElementBlock("span",X,[e.renderSlot(f.$slots,"loading",{},()=>[e.createTextVNode("Loading...")])])):(e.openBlock(),e.createElementBlock("span",Y,[e.renderSlot(f.$slots,"no-data",{},()=>[e.createTextVNode("No data")])]))]))],512)],512)]))}}),z={install(t,r={}){t.component("Vue3OrgChart",V)}};exports.Vue3OrgChart=V;exports.Vue3OrgChartPlugin=z;
